<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Alumni+Sans:wght@700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;500&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="work-showcase-styles.css">
    <!-- Material Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body>
    <!-- Navigation back Arrow -->
    <div class="arrow-container" id="arrow-container" onclick="goBack()">
        <svg id="arrow-icon" width="70" height="70" viewBox="0 0 100 100">
            <polygon points="40,20 80,50 40,80 40,60 20,60 20,40 40,40" fill="#E17918" stroke="black" stroke-width="2"/>
        </svg>
    </div>
    <!-- Project Description -->
    <div class="container">
        <div class="row">
            <div class="col-12">
                 <!-- Project Selection Dropdown as Title -->
                <select id="projectDropdown" onchange="updateProjectData()" class="display-1">
                <!-- <option value="">Select a Project</option> -->
                <!-- Options will be populated dynamically -->
                </select>
                <h2 class="fs-5"></h2>
                <p class="caption-text"></p>
            </div>
            <div class="col-12">
                <button class="collapsible">
                    <span>About</span>
                    <i class="material-icons expand-more-icon">expand_more</i>
                </button>
                <div class="content description-content">
                </div>
                <button class="collapsible">
                    <span>Process</span>
                    <i class="material-icons expand-more-icon">expand_more</i>
                </button>
                <div class="process-container">
                    <div class="process-content"></div>
                </div>
                <div class="col-12">
                    <!-- New Container for Media Grid -->
                    <div class="media-grid" id="mediaGrid">
                        <!-- Initially empty; we'll populate it with JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        <!-- This will be generated dynamically -->
        <div class="media-modal" id="mediaModal">
            <div class="modal-content-container">
                <div class="modal-content">
                    <!-- Media content will go here -->
                    <div class="media-container">
                        <!-- Media, like img, video, etc. -->
                    </div>
                    <div class="media-description">
                        <!-- Optional description text -->
                    </div>
                    <span class="close-btn" onclick="closeModal('mediaModal')">&times;</span>
                </div>
            </div>
        </div>
        <footer class="fixed-bottom footer">
            <div class="text-uppercase">Work</div>
        </footer>
        <script src="https://player.vimeo.com/api/player.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                fetchData();
            });
// Back arrow functionality
            function goBack() {
                // Check if the user is at the top of the page or close to it
                if (window.pageYOffset > 100) { // 100px is the threshold you can define
                // If not at the top, scroll to the top
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                // If at the top, navigate to the main page
                    window.location.href = 'https://reallygoodmostly.github.io/work/';
                }
            }
// Fetch the data
            async function fetchData() {
                try {
                    const response = await fetch('projects.json');
                    const data = await response.json();
                    populateProjectDetails(data.projects[0]);
            // Recalculate maxHeight for all collapsible elements
                    const collapsibles = document.getElementsByClassName("collapsible");
                    for (let i = 0; i < collapsibles.length; i++) {
                        const content = collapsibles[i].nextElementSibling;
                        if (content.style.maxHeight) {
                            content.style.maxHeight = (content.scrollHeight + 20) + "px";
                        }
                    }
                } catch (error) {
                    console.error('There was an error!', error);
                }
            }

// Populate project details
            function populateProjectDetails(project) {
                document.querySelector('.display-1').textContent = project.title;
                document.querySelector('.fs-5').textContent = project.description;
                document.querySelector('.caption-text').innerHTML = project.caption.split(';').join('<br>');

                populateCreditInfo(project.creditInfo);
                populateMediaGrid(project.media);
                populateProcessImages(project.process);

// Attach collapsible functionality
                const coll = document.getElementsByClassName("collapsible");
                for (let i = 0; i < coll.length; i++) {
                    coll[i].addEventListener("click", toggleCollapsible);
                }
                function populateProcessImages(processImages) {
                    const processContent = document.querySelector('.process-content');
                    const imagesHTML = processImages.map(src => `
                        <img src="${src}" class="process-image">
                        `).join('');
                    processContent.innerHTML = imagesHTML;
                }
            }

// Populate credit info
            function populateCreditInfo(creditInfo) {
                const creditInfoContent = '<ul>' + creditInfo.map(item => `<li>${item}</li>`).join('') + '</ul>';
                document.querySelector('.description-content').innerHTML = creditInfoContent;
            }

// Populate media grid
            function populateMediaGrid(mediaItems) {
                const mediaGrid = document.getElementById("mediaGrid");
                mediaItems.forEach((mediaItem, index) => {
                    const box = createMediaBox(mediaItem, index);
                    mediaGrid.appendChild(box);
                });
            }

// Toggle collapsible content
            function toggleCollapsible(event) {
                event.stopPropagation();
                this.classList.toggle("active");
                let content;
                if (this.textContent.includes("Process")) {
                    content = this.nextElementSibling.querySelector('.process-content');
                } else {
                    content = this.nextElementSibling;
                }
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                    content.style.padding = '0';
                    content.style.borderWidth = '0px';
                    content.style.marginLeft = '0';
                } else {
                 // Force a reflow to make sure scrollHeight is accurate
                    content.style.maxHeight = 'none';
                    const scrollHeight = content.scrollHeight;
                // Recalculate maxHeight based on current scrollHeight
                    content.style.maxHeight = (content.scrollHeight + 20) + "px";
                    content.style.padding = '10px';
                    content.style.borderWidth = '1px';
                    content.style.marginLeft = '25vw';
                }
            }
// Create a media box
            function createMediaBox(mediaItem, index) {
                const box = document.createElement("div");
                box.classList.add("media-box");

                let mediaContent = "";
                let modalMediaContent = "";

                if (mediaItem.type === 'image') {
                    const addIcon = document.createElement("i");
                    addIcon.classList.add("material-icons", "add-icon");
                    addIcon.textContent = "add";

                    const imageElement = document.createElement("img");
                    imageElement.src = mediaItem.path;
                    imageElement.alt = mediaItem.description || '';

                    box.appendChild(imageElement);
                    box.appendChild(addIcon);

                    modalMediaContent = `<img src="${mediaItem.path}" alt="${mediaItem.description || ''}">`;
                } else if (mediaItem.type === 'video') {
                    const videoContainer = document.createElement("div");
                    videoContainer.classList.add("video-container");

                    const videoThumbnail = document.createElement("img");
                    videoThumbnail.src = mediaItem.thumbnail;
                    videoThumbnail.alt = mediaItem.description || '';

                    const videoFlag = document.createElement("div");
                    videoFlag.classList.add("video-flag");
                    videoFlag.textContent = "VIDEO!";

                    videoContainer.appendChild(videoThumbnail);
                    videoContainer.appendChild(videoFlag);
                    box.appendChild(videoContainer);

                    modalMediaContent = `
                    <div class="aspect-ratio-16-9">
                    <iframe src="https://player.vimeo.com/video/${mediaItem.videoID}?playsinline=0" frameborder="0" allow="autoplay; fullscreen; picture-in-picture"></iframe>
                    </div>`;

                }
                const modal = document.createElement("div");
                modal.classList.add("media-modal");
                modal.id = `mediaModal${index + 1}`;
                modal.innerHTML = `
                <div class="modal-content">
                <span class="close-btn" onclick="closeModal('mediaModal${index + 1}')">&times;</span>
                <div class="media-container">
                ${modalMediaContent}
                </div>
                <div class="media-description">
                ${mediaItem.description || ""}
                </div>
                </div>`;
                document.body.appendChild(modal);
                box.addEventListener("click", () => {
                    modal.style.display = "block";
                });
                return box;
            }

// Modal close function
            function closeModal(modalId) {
                const modal = document.getElementById(modalId);
                modal.style.display = "none";
    // Find any Vimeo iframes within the modal and stop their content
                const iframes = modal.getElementsByTagName('iframe');
                for (let iframe of iframes) {
                    if (iframe.src.includes("vimeo")) {
                        const player = new Vimeo.Player(iframe);
                        player.pause().then(function() {
                // The video was paused
                        }).catch(function(error) {
                            console.error('Error pausing the video:', error);
                        });
                    }
                }
            }

// Listen for a click event on the entire window
            window.addEventListener('click', function(event) {
            // Check if the clicked element has the class 'media-modal' or 'media-container'
                if (event.target.classList.contains('media-modal') || event.target.classList.contains('media-container')) {
            // If so, close the modal. This assumes your modal has an ID or a specific way to be closed.
            // Fetch all elements with class 'media-modal' and hide them
                    document.querySelectorAll('.media-modal').forEach(function(modal) {
                        modal.style.display = 'none';
                    });
                }
            });
        </script>
    </body>
    </html>